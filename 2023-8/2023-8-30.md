# Shell

### 1. Shell 概述

​	Shell 是一个命令行解释器，它接收应用程序 / 用户命令，然后调用操作系统内核。

​	Shell 还是一个功能相当强大的编程语言，易编写、易调试、灵活性强。

### 2. Shell 入门

​	2.1 创建一个 Shell 脚本，输出 HelloWorld

```shell
touch hello.sh

vim hello
```

​		脚本格式：#!/bin/bash

​	2.2 hello.sh 脚本内容

```shell
#!/bin/bash

echo "Hello World"
```

​	2.3 使用脚本命令

```shell
sh hello.sh

bash hello.sh
```

​	2.4 多命令操作

```shell
#!/bin/bash

# 切换到shell_learn目录
cd /root/shell_learn
# 创建monitor文本
touch monitor.txt
# 将打印的字符串重定向到monitor.txt
echo "Hello Monitor" >> monitor.txt
```

### 3. Shell 中的变量	

​	3.1 $n 特殊变量

​		$n （功能描述：n 为数字，$0 代表该脚本名称，$1 - $9 代表第一到第九个参数，是以上的参数需要用大括号包含，如${10}）

​		创建 shell 脚本文件

​		vim 编辑器填写脚本

```shell
#!/bin/bash

echo "$0 $1 $2 $3"
```

​	3.2 $# 特殊变量

​		$# （功能描述：获取所有输入参数个数，常用于循环）

```shell
touch param.sh

vim param.sh
```

​		vim 编辑脚本格式

```shell
#!/bin/bash

echo "$0 $1 $2 $3"

echo $#
```

​	3.3 $*、$@ 特殊变量

​		$* （功能描述：这个变量代表命令行中的所有参数，$*把所有参数看成一个整体）

​		$@（功能描述：这个变量也代表命令行中所有的参数，不过$@把每个参数区分对待）

​	3.4 $? 特殊变量

​		 $?（功能描述：最后一次执行命令的返回状态，如果变量值为0，则上一个命令成功执行。如果变量值为非0，则证明上一个命令执行不正确）

# 计算机网络

###  1. TCP 标志位

​	SYN：同步标志位，用于建立会话连接，同步序列号

​	ACK：确认标志位，对已接收的数据包进行确认

​	FIN：完成标志位，表示已经没有数据要发送了，即将关闭连接

### 2. TCP 包首部

​	2.1 TCP 端口号

​		TCP 的连接是需要四个要素确认唯一一个连接：

​		（源 IP ，源端口号） + （目的地 IP ，目的端口号） 

​		TCP 首部预留了两个 16 位作为源端口号和目的端口号的存储

​	2.2 TCP 序号和确认号

​		32 位序号 seq：TCP 通信过程中某一个传输方向上的字节流的每个字节的序号，通过这个来确认发送的**数据有序**，比如现在序列号为 1000 ，发送了 1000 ，下一个序列号就是 2000

​		32 位确认号 ack：Acknowledge number 缩写为 ack，TCP 对上一次 seq 序号做出的确认号，用来响应 TCP 报文段，给收到的 TCP 报文段的序号 seq + 1

### 3. TCP 三次握手

​	三次握手指的是建立一个 TCP 连接时，需要客户端和服务器总共发送 3 个报文。

​	三次握手的目的是连接服务器的指定端口，建立 TCP 连接，并同步连接双方的序列号和确认号，交换 TCP 窗口大小信息。在 socket 编程中，客户端执行 connect() 时。将触发三次握手。

​	2.1 第一次握手：

​		客户端将 TCP 报文标志位的 SYN 置为 1，随机产生一个序列号值为 seq = J，保存在 TCP 首部的序列号字段里，指明客户端打算连接的服务器端口号，将该数据包发送给服务器端，发送完毕后，客户端进入SYN_SENT状态，等待服务器端确认。

​	2.2 第二次握手：

​		服务器端受到数据包后，因为 SYN = 1 所以接收客户端建立连接的请求。服务器端将 TCP 报文标志位 SYN 和 ACK 都置为 1，ack = J + 1，随机产生一个序号值 seq = K，并将数据包发送给客户端以确认连接请求，服务器端进入 SYN_RCVD 状态。

​	2.3 第三次握手：

​		客户端收到确认后，检查 ack 是否为 J + 1，ACK是否为 1，如果正确则将标志位 ACK 置为 1，如果正确则将标志位 ACK 置为 1，ack = K + 1，并将数据包发送给服务器端，服务器端检查ack是否为 K + 1，ACK 是否为 1，如果正确则连接建立成功，客户端和服务器端进入 ESTABLISHED 状态，完成三次握手，随后客户端和服务端之间可以开始传输数据了。

### 4. 为什么是三次握手 ？

​		假设 client 发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达 Server 服务端

​		如果不采用三次握手，那么只要 Server 确认 ack = seq + 1，那么新的连接就建立了。但此时 Client 没有发送请求，而 Server 会一直等待 Client 发送数据包，这时 Server 等待数据包中的过程中就会白白消耗很多资源。 

​	

​		





​		